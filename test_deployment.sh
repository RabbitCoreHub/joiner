#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–ø–ª–æ—è –Ω–∞ Render.com
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./test_deployment.sh https://your-app.onrender.com

API_URL=$1

if [ -z "$API_URL" ]; then
    echo "‚ùå –£–∫–∞–∂–∏—Ç–µ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ./test_deployment.sh https://your-app.onrender.com"
    exit 1
fi

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ø–ª–æ—è: $API_URL"
echo "=================================="

# –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞
echo "üîç –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞..."
if curl -s "$API_URL" > /dev/null; then
    echo "‚úÖ –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo "‚ùå –°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    exit 1
fi

# –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å—Ç–∞—Ç—É—Å–∞
echo "üîç –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å—Ç–∞—Ç—É—Å–∞..."
STATUS=$(curl -s "$API_URL/api/status" | grep -o '"status":"[^"]*"' | cut -d'"' -f4)
if [ "$STATUS" = "online" ]; then
    echo "‚úÖ API —Å—Ç–∞—Ç—É—Å: –æ–Ω–ª–∞–π–Ω"
else
    echo "‚ùå API —Å—Ç–∞—Ç—É—Å: $STATUS"
fi

# –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∏–Ω–≥–∞
echo "üîç –¢–µ—Å—Ç 3: –¢–µ—Å—Ç –ø–∏–Ω–≥–∞..."
PING_RESPONSE=$(curl -s -X POST "$API_URL/api/ping" \
    -H "Content-Type: application/json" \
    -d '{"source": "deployment_test"}')

if echo "$PING_RESPONSE" | grep -q "success"; then
    echo "‚úÖ –ü–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω"
else
    echo "‚ùå –ü–∏–Ω–≥ –Ω–µ—É–¥–∞—á–µ–Ω: $PING_RESPONSE"
fi

# –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
echo "üîç –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞..."
if curl -s "$API_URL" | grep -q "Roblox Auto-Joiner Dashboard"; then
    echo "‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è"
else
    echo "‚ùå –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
fi

# –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
echo "üîç –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤..."
LOGS=$(curl -s "$API_URL/api/logs")
if echo "$LOGS" | grep -q "logs"; then
    echo "‚úÖ –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã"
else
    echo "‚ùå –õ–æ–≥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
fi

echo "=================================="
echo "üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:"
echo "   - –°–∞–π—Ç: –î–æ—Å—Ç—É–ø–µ–Ω"
echo "   - API: $STATUS"
echo "   - –ü–∏–Ω–≥: –†–∞–±–æ—Ç–∞–µ—Ç"
echo "   - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –î–æ—Å—Ç—É–ø–µ–Ω"
echo "   - –õ–æ–≥–∏: –î–æ—Å—Ç—É–ø–Ω—ã"
echo ""
echo "üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!"
echo "üìù –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å URL –≤ roblox_client.lua"
echo "üîó –í–∞—à API URL: $API_URL"
